<html>

<head>
  <title>modpro</title>
   <link rel='stylesheet' href='https://use.fontawesome.com/releases/v5.7.0/css/all.css'>
   <script src="https://fivetechsoft.github.io/xcloud/source/js/xcloud.js"></script>
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
   <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
   <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
   <link rel="stylesheet" type="text/css" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/themes/base/jquery-ui.css"/>   <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
   <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
   <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

   <style>
      .dropdown-menu{
         color:white;
      }
      .dropdown-item:hover{
         background-color: gray;
         color:black;
      }
      .navbar-nav{
         padding-left:15px;
      }
      .navbar-nav:hover{
         background-color: gray;
      }
      .nav-link.dropdown-toggle{
         padding-left:15px;
      }
      .dropdown-toggle::after{
         border-top:0px;
      }
      .dropdown-menu.dropdown-menu-left.bg-dark.show{
         margin-top:-6px;
         margin-left:-16px;
         box-shadow: 5px 5px 5px #606060;
      }
      .navbar.navbar-expand-lg.navbar-light.bg-light.navbar-dark.bg-dark{
         margin-top:-5px;
         margin-bottom:-5px;
         padding-top:0px;
         padding-bottom:0px;
      }
      .modal-backdrop{
        display:none;
      }
      .modal-dialog{
         display:none;
      }
   </style>

   <script>
      function Save()
      {
          var o = new Object();
      
          o[ 'source' ] = editor.getValue();
          console.log( 'PARAM', o );
                
          $.post( "id.prg", o )
            .done( function( data ) { console.log( 'DONE', data ); location.href="id.prg?" + data; } )
            .fail( function( data ) { console.log( 'ERROR', data ); } ); 
      }

      var nWnd = 1;

      function Command( cMsg, lScroll )
      {  
         var cId = "command" + nWnd++;

         if( lScroll == null )
            lScroll = false;

         $( '<div class="form" id="' + cId + 
            '" style="overflow:' + ( lScroll ? 'auto': 'none' ) + 
            ';position: absolute;width: 700px;height: 400px;' + 
            'top: 375px;left: 1016px;background-color:silver;box-shadow:5px 5px 5px 0, 0px 0px 5px 0;' + 
            'border-radius:5px;"></div>' ).appendTo( "#main" );
         
         $( "#" + cId ).draggable().resizable().click(function(){
            if( $(this).is('.ui-draggable-dragging') ) {
                  return;
            }
            $(".form").css( "z-index", 1 );
            $(this).css( "z-index", nWnd - 1 );
         });

         if( cMsg != null )
            $( "#" + cId ).html( cMsg );
      }

      function CloseAllForms()
      {
         nWnd = 1; 
         $(".form").remove();
      }

      var oFPicker;

      function OpenPrg()
      { 
         var oFile; 
         oFPicker = document.createElement( "input" );
         oFPicker.type = "file";
         oFPicker.accept = ".prg,.ch,.txt,.h,.c";
         oFPicker.style.visibility = "hidden";
         oFPicker.onchange = function( evt ){ 
           var reader = new FileReader();
           oFile = evt.target.files[0];
           reader.onload = function( e ) {
              editor.session.setValue( e.target.result ) };
           reader.readAsText( oFile ); 
           }

        oFPicker.click(); 
      } 

      function OpenDbf()
      { 
        var oFile; 
        oFPicker = document.createElement( "input" );
        oFPicker.type = "file";
        oFPicker.accept = ".dbf,.dbt,.fpt,.cdx,.ntx";
        oFPicker.style.visibility = "hidden";
        oFPicker.onchange = function( evt ){ 
           var reader = new FileReader();
           oFile = evt.target.files[0];
           reader.readAsDataURL( oFile ); 
           reader.onload = function( e ) {
               var formData = new FormData();
               var xhr = new XMLHttpRequest();
               var blob = new Blob( [e.target.result], {type: "application/octet-stream"} );
               formData.append( oFile.name, blob );
               xhr.onreadystatechange = function() { 
                  if( this.readyState == XMLHttpRequest.DONE && this.status == 200 ) {
                     Command( this.responseText, true ); } };
            xhr.open( "POST", 'upload.prg' );
            xhr.send( formData );
           }
         };

        oFPicker.click(); 
      } 

      function AddLabel()
      {
         $( "#command1" ).append( "<label id='label1'>Label</label>" );
         $( "#label1").draggable().resizable();
      }

      function AddInput()
      {
         $( "#command1" ).append( "<input type='text' id='input1'></input>" );
         $( "#input1").resizable();
         $( ".ui-wrapper" ).draggable( {cancel:false} );      }

      function AddButton()
      {
         $( "#command1" ).append( "<button id='button1'>button</button>" );
         $( "#button1").resizable();
         $( ".ui-wrapper" ).draggable( {cancel:false} );
      }

   </script>  
</head>